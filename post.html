<!doctype html>
<html lang="en">
<head>
  <title>Post ‚Äî {{SITE_TITLE}}</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="assets/style.css" />
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0b0c10" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
<header class="container header">
  <div class="brand">
    <div class="logo">SC</div>
    <div>
      <div class="brand-title" data-site-title>Events.SanCris</div>
      <div class="brand-sub" data-site-sub>Local guides ‚Ä¢ Events ‚Ä¢ Tips</div>
    </div>
  </div>
  <nav class="nav">
    <a href="index.html">Home</a>
    <a href="articles.html">Life</a>
    <a href="nature.html">Nature</a>
    <a href="events.html">Events</a>
    <a href="hotels.html">Hotels</a>
    <a href="restaurants.html">Food</a>
    <a href="music.html">Music</a>
    <a href="faq.html">FAQ</a>
    <a href="submit.html">Submit</a>
  </nav>
</header>

<main class="container">
  <section class="hero-card">
    <div class="hero-media"><img id="heroImg" alt="" /></div>
    <div class="hero-body">
      <h1 id="heroTitle">Loading‚Ä¶</h1>
      <p class="lead" id="heroDesc"></p>
      <div class="meta" id="heroMeta"></div>
    </div>
  </section>

  <article class="card prose" style="margin-top:16px;">
    <div id="postBody"></div>
    <div class="card-foot"><a href="javascript:history.back()">‚Üê Back</a></div>
  </article>
</main>

<footer class="container footer">
  <div class="muted small">¬© <span id="year"></span> <span data-site-title>Events.SanCris</span> ‚Ä¢ <a id="igLink" class="muted" href="#" target="_blank" rel="noreferrer">Instagram</a></div>
</footer>
<script src="assets/app.js"></script>
<script>
  (async () => {
    await App.initSite();
    const params = new URLSearchParams(location.search);
    const slug = params.get("slug") || "welcome";

    const [aData, pData] = await Promise.all([
      fetch("data/articles.json", {cache:"no-store"}).then(r=>r.json()).catch(()=>({articles:[]})),
      fetch("data/places.json", {cache:"no-store"}).then(r=>r.json()).catch(()=>({places:[]})),
    ]);
    const metaItem = (aData.articles||[]).find(x=>x.slug===slug) || (pData.places||[]).find(x=>x.slug===slug) || null;

    const heroImg = document.getElementById("heroImg");
    const heroTitle = document.getElementById("heroTitle");
    const heroDesc = document.getElementById("heroDesc");
    const heroMeta = document.getElementById("heroMeta");

    heroImg.src = (metaItem && metaItem.cover) ? metaItem.cover : "assets/images/cover-post.svg";
    heroImg.alt = metaItem ? (metaItem.title || "") : "";

    if (metaItem) {
      heroTitle.textContent = metaItem.title || "Post";
      heroDesc.textContent = metaItem.description || metaItem.excerpt || "";
      const bits = [];
      if (metaItem.date) bits.push(`üóìÔ∏è ${metaItem.date}`);
      if (metaItem.category) bits.push(`üè∑Ô∏è ${metaItem.category}`);
      heroMeta.innerHTML = bits.map(b => `<span class="badge accent">${b}</span>`).join(" ");
    }

    const mdUrl = `posts/${slug}.md`;
    const res = await fetch(mdUrl, {cache:"no-store"});
    const container = document.getElementById("postBody");
    if (!res.ok) {
      heroTitle.textContent = "Not found";
      heroDesc.textContent = `Missing file: ${mdUrl}`;
      container.innerHTML = `<p class="muted">Post not found.</p>`;
      return;
    }
    const md = await res.text();
    container.innerHTML = window.marked ? window.marked.parse(md) : `<pre>${md}</pre>`;
    const h1 = container.querySelector("h1");
    if (h1) h1.remove();

    document.title = `${heroTitle.textContent} ‚Äî ${document.title}`;
  })();
</script>
</body>
</html>
